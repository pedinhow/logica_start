{% extends 'base.html' %}

{% block content %}
<a href="{{ url_for('index') }}" class="btn btn-outline-secondary mb-3">‚Üê Voltar ao Menu</a>

<div class="card shadow">
    <div class="card-header bg-white">
        <h2>{{ lesson.title }}</h2>
    </div>
    <div class="card-body">
        <div class="theory-section mb-4">
            {{ lesson.theory | safe }}
        </div>

        <hr>

        {% if results %}
            <div class="alert {% if score == total %}alert-success{% else %}alert-warning{% endif %} mb-4">
                <h4>Resultado: Voc√™ acertou {{ score }} de {{ total }}!</h4>
                {% if score == total %}
                    <p>Parab√©ns! Voc√™ dominou este m√≥dulo. üéâ</p>
                    <a href="{{ url_for('index') }}" class="btn btn-success">Pr√≥xima Aula</a>
                {% else %}
                    <p>Revise os erros abaixo e tente novamente.</p>
                    <a href="{{ url_for('lesson', lesson_id=lesson_id) }}" class="btn btn-primary">Tentar Novamente</a>
                {% endif %}
            </div>
        {% endif %}

        {% if not results or score != total %}
        <h4 class="mb-3">üìù Desafio do M√≥dulo</h4>
        <form method="POST">
            {% for q in lesson.quiz %}
                <div class="card mb-3 border-light bg-light">
                    <div class="card-body">
                        <p class="fw-bold">{{ loop.index }}. {{ q.question | safe }}</p>

                        {% for option in q.options %}
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="{{ q.id }}" id="{{ q.id }}_{{ loop.index }}" value="{{ option }}" required>
                            <label class="form-check-label" for="{{ q.id }}_{{ loop.index }}">
                                {{ option }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
            <button type="submit" class="btn btn-primary btn-lg w-100">Verificar Respostas</button>
        </form>
        {% else %}
            {% for q in lesson.quiz %}
                <div class="card mb-2">
                    <div class="card-body">
                        <p class="fw-bold">{{ q.question | safe }}</p>
                        {% set res = results[q.id] %}
                        {% if res.is_correct %}
                            <span class="badge bg-success">Voc√™ acertou: {{ res.user_answer }} ‚úÖ</span>
                        {% else %}
                            <span class="badge bg-danger">Voc√™ marcou: {{ res.user_answer }} ‚ùå</span>
                            <span class="text-muted ms-2">Correto seria: <strong>{{ res.correct_answer }}</strong></span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>
</div>
{% endblock %}